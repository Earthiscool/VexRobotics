<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>VEX Simplified Time Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
<style>
  body{font-family:Arial,sans-serif;background:#f4f6fb;color:#07203a;margin:16px;}
  h1{margin-bottom:16px;}
  .container{display:flex;gap:24px;}
  .card{background:#fff;padding:16px;border-radius:8px;flex:1;box-shadow:0 4px 12px rgba(0,0,0,0.05);}
  .member{display:flex;gap:8px;align-items:center;margin-bottom:8px;flex-wrap:wrap;}
  .member input{padding:6px;border-radius:6px;border:1px solid #ccc;}
  .member .remove{background:#e74c3c;color:white;border:none;padding:6px 8px;border-radius:6px;cursor:pointer;}
  button{background:#174ea6;color:white;border:none;padding:8px 12px;border-radius:6px;cursor:pointer;margin-top:8px;}
  canvas{margin-top:16px;}
</style>
</head>
<body>
<h1>VEX Simplified Time Tracker</h1>

<div class="container">
  <div class="card">
    <h2>Members & Assignments</h2>
    <div id="inputsArea"></div>
    <button onclick="addMember()">+ Add Member</button>
    <button onclick="generateCharts()">Generate Charts</button>
    <button onclick="savePreset()">Save Preset</button>
    <button onclick="exportPDF()">Export PDF</button>
    <button onclick="exportBarChart()">Export Bar Chart</button>
  </div>

  <div class="card">
    <h2>Bar Chart</h2>
    <canvas id="barChart"></canvas>
  </div>
</div>

<script>
const DEFAULT_COLORS = ['#3b82f6','#ef4444','#f97316','#10b981','#8b5cf6','#f43f5e','#06b6d4','#a78bfa','#f59e0b','#84cc16'];
let barChart;

function addMember(name='', assignments=[{task:'', minutes:''}]) {
  const memberDiv = document.createElement('div');
  memberDiv.className='member';
  memberDiv.innerHTML = `
    <input type="text" placeholder="Member Name" value="${name}" />
    <div class="assignments"></div>
    <button onclick="addAssignment(this)">+ Task</button>
    <button class="remove" onclick="this.parentElement.remove()">✕</button>
  `;
  const assignmentsDiv = memberDiv.querySelector('.assignments');
  assignments.forEach(a=>addAssignmentRow(assignmentsDiv, a.task, a.minutes));
  document.getElementById('inputsArea').appendChild(memberDiv);
}

function addAssignment(btn){
  const assignmentsDiv = btn.parentElement.querySelector('.assignments');
  addAssignmentRow(assignmentsDiv);
}

function addAssignmentRow(container, task='', minutes=''){
  const row = document.createElement('div');
  row.style.display='flex'; row.style.gap='6px'; row.style.marginTop='4px';
  row.innerHTML = `
    <input type="text" placeholder="Task" value="${task}" />
    <input type="number" placeholder="Minutes" min="0" max="120" style="width:80px" value="${minutes}" />
    <button onclick="this.parentElement.remove()" style="background:#e74c3c;color:white;border:none;padding:4px 6px;border-radius:6px;">✕</button>
  `;
  container.appendChild(row);
}

function collectData(){
  const members = [];
  document.querySelectorAll('#inputsArea .member').forEach(m=>{
    const name = m.querySelector('input[type=text]').value || 'Unknown';
    const tasks = [];
    m.querySelectorAll('.assignments > div').forEach(r=>{
      const t = r.querySelector('input[type=text]').value || 'Task';
      const min = parseInt(r.querySelector('input[type=number]').value) || 0;
      tasks.push({task:t, minutes:min});
    });
    members.push({name, tasks});
  });
  return members;
}

function generateCharts(){
  const data = collectData();
  const labels = [];
  const minutes = [];
  data.forEach(member=>{
    member.tasks.forEach(t=>{
      labels.push(`${member.name} → ${t.task}`);
      minutes.push(t.minutes);
    });
  });
  const colors = [];
  for(let i=0;i<labels.length;i++) colors.push(DEFAULT_COLORS[i%DEFAULT_COLORS.length]);

  if(barChart) barChart.destroy();
  const ctx = document.getElementById('barChart').getContext('2d');
  barChart = new Chart(ctx,{
    type:'bar',
    data:{
      labels,
      datasets:[{
        label:'Minutes',
        data:minutes,
        backgroundColor:colors
      }]
    },
    options:{
      indexAxis:'y',
      plugins:{
        legend:{display:false},
        datalabels:{
          anchor:'end',
          align:'right',
          color:'#000',
          font:{weight:'bold'}
        }
      },
      scales:{
        x:{beginAtZero:true},
        y:{
          ticks:{
            font:{
              weight:'bold',   // makes left-hand labels bold
              size:12          // you can also increase size for readability
            }
          }
        }
      }
    },
    plugins: [ChartDataLabels]
  });
}


function exportPDF(){
  html2canvas(document.querySelector('#barChart')).then(canvas=>{
    const imgData = canvas.toDataURL('image/png');
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();
    pdf.addImage(imgData,'PNG',15,40,180,100);
    pdf.save('vex_schedule.pdf');
  });
}

function exportBarChart(){
  const a = document.createElement('a');
  a.href = document.getElementById('barChart').toDataURL('image/png');
  a.download = 'bar_chart.png';
  a.click();
}

function savePreset(){
  const data = collectData();
  localStorage.setItem('vex_preset', JSON.stringify(data));
  alert('Preset saved locally!');
}

function loadPreset(){
  const data = JSON.parse(localStorage.getItem('vex_preset') || '[]');
  document.getElementById('inputsArea').innerHTML='';
  data.forEach(m=>addMember(m.name,m.tasks));
}

// initial
loadPreset();
</script>
</body>
</html>
